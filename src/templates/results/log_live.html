{% extends "base.html" %}
{% load staticfiles %}

{% block header %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href='{% static "css/results.css" %}'>
{% endblock %}

{% block breadcrumbs %}
<div class="container">
    <ol class="breadcrumb">
        <li><a href="{% url 'index' %}">Home</a></li>
        <li><a href="{% url 'results:detail' object.id %}">Job {{object}}</a></li>
        <li class="active">Log live</li>
    </ol>
</div>
{% endblock %}

{% block content %}
<div class="container">
	
    <div class="page-header">
        <h1>Live Log results for <small>{{object}}</small></h1>
    </div>
    <table class="table table-hover">
        <thead>
            <th>ID</th>
            <th>Time</th>
            <th>Stream</th>
            <th>Content</th>
        </thead>
        <tbody id="job-log-rows"></tbody>
            </table>
</div>
{% endblock %}

{% block footer_js%}
{{ block.super }}
<script src='{% static "thirdparty/reconnecting-websocket/reconnecting-websocket.min.js" %}'></script>
<script>
socket = new ReconnectingWebSocket("ws://" + window.location.host + "/job-log/{{ object.id }}/");
socket.onmessage = function(e) {
  var { log_id, time, content, stream } = JSON.parse(e.data);
  $('#job-log-rows').append(
    $('<tr>').append(
      $('<td>').text('' + log_id)
    ).append(
      $('<td>').text('' + time)
    ).append(
      $('<td>').text('' + stream)
    ).append(
      $('<td>').append(
        $('<pre>').text('' + content)
      )
    )
  );
}
socket.onopen = function() { }
// Call onopen directly if socket is already open
if (socket.readyState == WebSocket.OPEN) socket.onopen();

</script>
{% endblock %}

